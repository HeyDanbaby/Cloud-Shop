# Usecloud.usemall 用云电商 v2.3.1
**用云电商 uniCloud 版，完整商用级项目应用，一套 js 解决前端、后端、数据库的全栈开发  serverless 模式（小程序、h5、android、iOS、vue + element-ui + uniCloud 版管理后台）。持续更新中**  

说明：目前支持微信小程序、支付宝小程序、h5Weixin、h5、iOS、Android，其他平台持续更新中。（**可定制跨境电商、海关申报、仓储系统、物联网等项目**）

** 用云 · 让开发更简单！**  

### 用户端 - 技术栈
	uni-app + uniCloud + vue2
### 管理端 - 技术栈
	uni-app + uniCloud + vue2 + element-ui
### 后端服务 - uniCloud
	[引用于官方文档] uniCloud 是 DCloud 联合阿里云、腾讯云基于 serverless 模式和 js 编程的云开发平台，使用 nodejs + mongodb 开发。
	
	[引用于官方文档] serverless 是无服务器模式，无需关注器务器运维、弹性扩容、大并发承载、防DDoS攻击等，只需关注自身应用业务。
	
	[引用于官方文档] 目前 uniCloud 阿里云版免费（免费的服务器空间、CDN云存储、网页托管等），助力开发者低门槛实现自己的想法。
	
	[引用于官方文档] 目前 uniCloud 已发展2年多，活跃服务空间数万，云函数日请求数量过亿。请放心使用。

## [uni-app 官方文档](https://uniapp.dcloud.net.cn/)
## [uniCloud 官方文档](https://uniapp.dcloud.net.cn/uniCloud/)
## [uniCloud 云数据库](https://uniapp.dcloud.net.cn/uniCloud/hellodb.html)


## 用云团队项目推荐  
> **[1. 用云电商 uniCloud v1.0.9 版前后端开源](https://ext.dcloud.net.cn/plugin?id=5764)**  
> **[2. 用云电商 uniCloud 付费版](https://ext.dcloud.net.cn/plugin?id=5211)**  
> **[3. 用云·IM uniCloud 体验版](https://ext.dcloud.net.cn/plugin?id=5544)**  
> **[4. 用云·BI uniCloud 数据大屏](https://ext.dcloud.net.cn/plugin?id=5893)**  
> **[5. 用云·O2O uniCloud 付费版](https://use-cloud.com/#/pages/market/product/detail?product=6388719c8656970001267259)**  

**功能列表**
>0. 【已完成】查看物流（快递100）
>1. 【已完成】商品海报图（生成、分享好友、保存相册）  
>2. 【已完成】我的钱包（充值、余额、提现）、领券中心、我的优惠券  
>3. 【已完成】分销中心（分享绑定分销关系，购买分销商品，佣金返利，佣金提现）  
>4. 【已完成】多规格SKU，注册、登录-隐私协议，常见问题，自定义头部，积分商城，瀑布流
>5. 【已完成】统一UI风格，意见反馈，修改密码，授权登录流程优化，分销商海报，产品列表二级分类筛选
>6. 【已完成】会员中心、会员商品、开通会员、会员价下单、每日签到、积分商城、积分兑换、积分明细
>7. 【已完成】领券中心、我要兑换、商品领券、使用优惠券、我的优惠券 
>8. 【已完成】购物圈功能类似淘宝逛逛，可分享文字+图片+视频+商品  
		a. 购物圈列表页（tab + swiper）实现，可左右滑动切换、上拉加载下一页、预自动加载下一个 swiper-item 数据。  
		b. 购物圈详情页（swiper + video）实现，可上下滑动切换、切换自动播放视频（类似抖音、视频号效果）、点赞、收藏、分享、买同款等功能。
>9. 【已完成】积分抽奖，积分激励视频广告，快递费模板  
>10. IM客服（文字、图片、视频、产品、订单、评价、猜你想问、机器人问答）


## 手机扫码体验
|微信小程序|H5|APP|
|----|----|----|
|<img src="https://mp-7e00db99-ad65-4b9f-a74b-61bccb92b124.cdn.bspapp.com/cloudstorage/c933de08-efd2-40cc-852d-3ffab05ab9ec.png" style="width: 240px" width="240px" />|<img src="https://mp-7e00db99-ad65-4b9f-a74b-61bccb92b124.cdn.bspapp.com/cloudstorage/221cf6f7-f384-46c7-9a5c-429c850dca82.png" style="width: 240px" width="240px" />|<img src="https://mp-7e00db99-ad65-4b9f-a74b-61bccb92b124.cdn.bspapp.com/cloudstorage/48d34d3d-1422-48ff-ab8c-d0d04f26f5ca.png" style="width: 240px" width="240px" />|

## [点击体验管理后台](https://usemall-b2c.use-cloud.com)
> 账号：usemall  
> 密码：1234  

**[用云电商管理后台v1.0.9版本，加官方群联系客服免费获取源代码]。**  

QQ群① [1020565856](https://jq.qq.com/?_wv=1027&k=hjvUel1z&jump_from=usecloud)（2000人已满）  
QQ群② [611522021](https://jq.qq.com/?_wv=1027&k=ixdKtueT&jump_from=usecloud)  

## [点击访问用云官网](https://use-cloud.com)

## 新手指南
1. 下载 [HBuilderX](https://www.dcloud.io/hbuilderx.html) 开发者工具
2. 插件安装 <br />工具栏 -> 工具(T) -> 插件安装 -> 安装新插件（[scss/sass编译](https://ext.dcloud.net.cn/plugin?id=2046)、[stylus编译](https://ext.dcloud.net.cn/plugin?id=2016)）

## 快速上手
1. 使用 HBuilderX 导入插件
2. 关联 uniCloud 服务空间（[创建 uniCloud 服务空间](https://uniapp.dcloud.io/uniCloud/quickstart?id=%e5%88%9b%e5%bb%ba%e5%92%8c%e7%bb%91%e5%ae%9a%e6%9c%8d%e5%8a%a1%e7%a9%ba%e9%97%b4)）
3. 运行 uniCloud -> database -> db_init.josn（右键：初始化云数据库(包含Schema和校验函数)）
4. 配置 uniCloud -> cloudfunctions -> 云函数 common 目录下 uni-config-center -> uni-id -> config.json 文件 [官方文档](https://uniapp.dcloud.net.cn/uniCloud/uni-id?id=configjson%e7%9a%84%e8%af%b4%e6%98%8e)
5. **修改 配置文件 需重新右键 uni-config-center 上传公共模块**
    1. uni-id
```
	"env": "dev", // dev | online 配置当前环境
	"passwordSecret": [{
		"version": 1,
		"value": "usemall.unicloud.password.secret"
	}],
	"tokenSecret": "usemall.unicloud.token.secret",
	"tokenExpiresIn": 259200,
	"tokenExpiresThreshold": 600,
	"passwordErrorLimit": 6,
	"passwordErrorRetryTime": 3600,
	"autoSetInviteCode": false,
	"forceInviteCode": false,
	"bindTokenToDevice": false,
	"preferedAppPlatform": "app",
	"preferedWebPlatform": "h5",
```
    2. APP 微信授权登录与支付
```
	"app": {
		"tokenExpiresIn": 2592000,
		"oauth": {
			"weixin": {
				"appid": "微信开放平台-应用appid",
				"appsecret": "微信开放平台-应用appsecret"
			}
		},
		"wxpay": {
			"appId": "微信开放平台-应用appid",
			"mchId": "微信支付商户号",
			"key": "微信支付商户key (APIv2密钥)"
		},
		"notify-wxpay-url": "notify 云函数URL化http地址 + /wxpay-app",
		"notify-vip-wxpay-url": "notify-vip 云函数URL化http地址 + /wxpay-app",
		"notify-recharge-wxpay-url": "notify-recharge 云函数URL化http地址 + /wxpay-app"
	},
```
    3. 微信公众号授权与支付
```
	"h5-weixin": {
		"tokenExpiresIn": 259200,
		"oauth": {
			"weixin": {
				"appid": "微信公众号appid",
				"appsecret": "微信公众号appsecret"
			}
		},
		"pay": {
			"appId": "微信公众号appid",
			"mchId": "微信支付商户号",
			"key": "微信支付商户key (APIv2密钥)"
		},
		"notify-url": "notify 云函数URL化http地址 + /wxpay-h5wx",
		"notify-vip-url": "notify-vip 云函数URL化http地址 + /wxpay-h5wx",
		"notify-recharge-url": "notify-recharge 云函数URL化http地址 + /wxpay-h5wx",
		"server": {
			// 微信公众号 -> 设置与开发 -> 基本配置 -> 服务器配置
			"url": "服务器地址（URL）填写云函数 usemall-wx-service 开启url化的完整地址",
			"token": "令牌（Token）",
			"encodingAESKey": "消息加解密密钥（EncodingAESKey），安全模式下已处理加密、解密"
		},
		"url": "微信公众号-项目部署上线的url地址",
		"access-token-server": "aliyun | tcb 微信公众号获取access_token云服务端",
		"message-notify-enabled": "true | false 是否开启微信公众号消息通知"
	},
```
	4. 微信小程序授权与支付
```
	"mp-weixin": {
		"tokenExpiresIn": 259200,
		"oauth": {
			"weixin": {
				"appid": "微信小程序appid",
				"appsecret": "微信小程序appsecret"
			}
		},
		"pay": {
			"appId": "微信小程序appid",
			"mchId": "微信支付商户号",
			"key": "微信支付商户key (APIv2密钥)"
		},
		"notify-url": "notify 云函数URL化http地址 + /wxpay",
		"notify-vip-url": "notify-vip 云函数URL化http地址 + /wxpay",
		"notify-recharge-url": "notify-recharge 云函数URL化http地址 + /wxpay"
	},
```
    5. 支付宝授权与支付
```
	"mp-alipay": {
		"tokenExpiresIn": 259200,
		"oauth": {
			"alipay": {
				"appid": "支付宝小程序appid",
				"privateKey": "支付宝小程序私钥",
				"keyType": "支付宝小程序私钥类型"
			}
		},
		"pay": {
			"appId": "支付宝小程序appid",
			"mchId": "支付宝商户号",
			"privateKey": "应用私钥字符串",
			"alipayPublicKey": "支付宝公钥"
		},
		"notify-url": "notify 云函数URL化http地址 + /alipay",
		"notify-vip-url": "notify-vip 云函数URL化http地址 + /alipay",
		"notify-recharge-url": "notify-recharge 云函数URL化http地址 + /alipay"
	},
```
    6. DCloud 短信配置，开通访问[官方文档](https://uniapp.dcloud.io/uniCloud/send-sms)
```
	"service": {
		"sms": {
			"name": "短信签名内容，短信验证码 -> 签名配置 -> 签名内容（不需要【】符号）",
			"codeExpiresIn": 600,
			"smsKey": "短信密钥key",
			"smsSecret": "短信密钥secret"
		},
		"smscode": {
			"templateId": "验证码短信模板Id"
		}
	}
```
    7. [快递100](https://api.kuaidi100.com?f=usemall)
```
	"kd100": {
		"customer": "快递100 customer",
		"key": "快递100 授权KEY"
	}
```
    8. 消息通知 [unipush2.0 开通指南](https://uniapp.dcloud.net.cn/unipush-v2.html)（已付款待发货、订单售后申请、用户提现相关等通知）
```
	"message-notify": {
		"enabled": "true | false 是否启用消息通知",
		"key": "随机KEY值，验证消息来源，防止非法调用",
		"url": "云函数 usemall-message-notify 开启url化的完整地址"
	}
```
5. 运行 uniCloud -> cloudfunctions（右键：上传所有云函数、公共模块及actions）  
6. 配置 manifest.json [官方文档](https://uniapp.dcloud.io/collocation/manifest)  
    A. 基础配置  
    B. 微信小程序配置，填写 appid  
    C. h5配置  
7. 工具栏 -> 运行(R) ->  
    A. 运行到浏览器([体验h5版本]) 注意 [配置跨域](https://uniapp.dcloud.io/uniCloud/quickstart?id=useinh5)   
    B. 运行到小程序模拟器(微信开发者工具[体验微信小程序版本])  
8. **注意点（重要、重要、重要）**  
    A. 连接本地云函数（右键 uniCloud -> database 下载所有DB Schema及扩展校验函数）[注意事项](https://uniapp.dcloud.io/uniCloud/quickstart?id=%e8%b0%83%e7%94%a8%e6%9c%ac%e5%9c%b0%e4%ba%91%e5%87%bd%e6%95%b0%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9) 。   
    B. 连接本地云函数运行出错，则需右键云函数 usemall -> 管理公共模块依赖 -> 更新选中依赖。  
    C. 连接云端云函数，注意小程序开发工具（校验|不校验合法域名、web-view（业务域名）、TLS版本以及HTTPS证书）。  
    D. 小程序中使用 uniCloud [白名单配置](https://uniapp.dcloud.io/uniCloud/quickstart.html#useinmp)。  
9. **创作不易，请勿以差评的评论方式提问，谢谢！有任何问题欢迎加群 [1020565856](https://qm.qq.com/cgi-bin/qm/qr?k=BNUlrZAQXPolwALtcBm_rMabq0bx3_n-&jump_from=usecloud) 咨询。**
10. **长期招募合伙人！加企业微信咨询。**

## 常见问题
**1. 如何开启云函数 url 化，填写对应的支付回调地址。**  
> A. 在uniCloud控制台，进入对应的云函数详情页，**云函数URL化** 编辑填写加上 /http/函数名称。  
<img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7e00db99-ad65-4b9f-a74b-61bccb92b124/3d6d4145-7864-4e16-a0d2-60e8d4e8f1ac.png" width="500px" />  
<img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7e00db99-ad65-4b9f-a74b-61bccb92b124/780c1912-ef74-4404-bba1-2c8ed817dbbb.png" />  
> B. 比如 notify 云函数，设置URL的PATH部分编辑填写上 /http/notify。  
<img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7e00db99-ad65-4b9f-a74b-61bccb92b124/530ff220-1e7c-44b8-af30-75a5b4be3894.png" />  

**2. 为何修改配置文件密码加密Token后，无法登录？**  
> A. [修改说明](https://uniapp.dcloud.net.cn/uniCloud/uni-id?id=modifysecret) 需新增密码加密 Token version。  
> B. 修改passwordSecret会导致老用户使用密码无法登录，修改tokenSecret会导致所有已经下发的token失效。  
> C. [官方详细介绍](https://uniapp.dcloud.io/uniCloud/uni-id?id=config)  

**3. 为何微信小程序授权登录没反应或登录不了？**  
> A. 确认是否已在配置文件中填写对应的 appid、appsecret。  
> B. 修改后的配置文件是否已右键重新上传。  

**4. 为何运行后提示 {"errMsg": "Cannot find module 'uni-cloud-router'"}。**  
> A. 提示未找到依赖模块，导致此问题是因为连接本地云函数而未右键管理公共依赖导致。  
> B. 可右键管理公共模块依赖，打开后默认勾选的确定后，重新运行。  
<img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7e00db99-ad65-4b9f-a74b-61bccb92b124/99df37d7-8067-4b81-aae5-6e9a12757989.png" width="560px" />  
> C. 可连接云端云函数解决。  
<img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7e00db99-ad65-4b9f-a74b-61bccb92b124/c5c806ff-9ecf-4c29-840b-95700a9f02f0.png" width="560px" />  

**5. 管理后台运行后提示 Error: Cannot find module 'uni-read-pages'。**  
> A. 需执行 npm i 安装依赖。  

**6. 管理后台添加模块提示 {"code": "VALIDATION_ERROR"}。**  
> A. 在uniCloud控制台，修改云数据库表结构 opendb-admin-menus 把 menu_id 去掉或者取消必填。  
<img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7e00db99-ad65-4b9f-a74b-61bccb92b124/04320c10-dbf4-456e-8251-54b257ed1b69.png" width="560px" />  

**7. 管理后台提示未在表 opendb-admin-menus 内发现合法的父子关系标识 parentKey。**  
> A. 在uniCloud控制台，修改云数据库表结构 opendb-admin-menus 在 parent_id 父级菜单Id 加上 "parentKey": "_id"。
<img src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7e00db99-ad65-4b9f-a74b-61bccb92b124/a5fc080f-192b-4626-b53c-ea3bbeb0108b.png" width="560px" />  

**8. 管理后台如何修改密码。**  
> A. 在 windows -> topWindow.vue 标签**el-dropdown-item修改密码**，取消对应代码中的 v-if="false"。

**9. 管理后台商品管理预览失败。**  
> A. 在预览功能中，修改源代码替换成自己的线上 h5 地址（源代码中的是 用云电商-h5版 地址）。

**10. 管理后台操作订单售后-同意退款未到账。**  
> A. 管理后台项目 uniCloud 云函数 useadmin -> controller -> cert -> wxpay 下添加微信支付证书 apiclient_cert.p12。  
> B. 右键云函数 useadmin 上传部署。  
> C. 管理后台重新操作同意退款。  

**11. 购物圈相关问题。**  
> A. 购买后联系企业微信客服免费获取 购物圈 源代码更新包。  
> B. 前端项目代码中配置内容安全检测 uniCloud -> common -> uni-config-center -> uni-sec-check 填写。  
> C. 前端项目代码中配置完成后右键 uni-config-center 上传公共模块。  

## 加QQ群、实时版本更新通知、各种活动福利

QQ群① [1020565856](https://jq.qq.com/?_wv=1027&k=hjvUel1z&jump_from=usecloud)（2000人已满）  
QQ群② [611522021](https://jq.qq.com/?_wv=1027&k=ixdKtueT&jump_from=usecloud)  

## 
## 添加微信18825282536，专属一对一服务
<img src="https://mp-7e00db99-ad65-4b9f-a74b-61bccb92b124.cdn.bspapp.com/cloudstorage/ecad0bf8-d640-41d4-80fe-fcc437b6a874.jpg" style="width: 320px" width="320px" />

## 用云团队项目推荐  
> **[1. 用云电商 uniCloud v1.0.9 版前后端开源](https://ext.dcloud.net.cn/plugin?id=5764)**  
> **[2. 用云电商 uniCloud 付费版](https://ext.dcloud.net.cn/plugin?id=5211)**  
> **[3. 用云·IM uniCloud 体验版](https://ext.dcloud.net.cn/plugin?id=5544)**  
> **[4. 用云·BI uniCloud 数据大屏](https://ext.dcloud.net.cn/plugin?id=5893)**  
> **[5. 用云·O2O uniCloud 付费版](https://use-cloud.com/#/pages/market/product/detail?product=6388719c8656970001267259)**  
